<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r54/three.js"></script>-->

    <script src='https://threejs.org/build/three.min.js'></script>
    <!--    <script src="https://unpkg.com/three@0.123.0/build/three.min.js"></script>-->
    <script src='https://threejs.org/examples/js/controls/OrbitControls.js'></script>
    <script src='three.js/examples/js/controls/PointerLockControls.js'></script>

</head><!--from   ww w  .  de  mo 2  s  .  c  om-->
<body>
<script type='text/javascript'>
    var camera, scene;
    var canvasRenderer, webglRenderer;
    var container, mesh, geometry, plane;
    var windowHalfX = window.innerWidth / 2;
    var windowHalfY = window.innerHeight / 2;
    init();
    animate();

    function init() {
        container = document.createElement('div');
        document.body.appendChild(container);
        camera = new THREE.PerspectiveCamera(30, window.innerWidth / window.innerHeight, 1, 100000);
        camera.position.x = 520;
        camera.position.y = 400;
        camera.position.z = -400;
        camera.lookAt({
            x: 0,
            y: 0,
            z: 0
        });
        scene = new THREE.Scene();
        // scene.background = new THREE.Color(0xdddddd);
        scene.add(new THREE.AxesHelper(500));
        var groundMaterial = new THREE.MeshPhongMaterial({
            color: 0x6C6C6C
        });


        const planeSize = 100;

        const loader = new THREE.TextureLoader();
        const texture = loader.load('https://threejsfundamentals.org/threejs/resources/images/checker.png');
        texture.wrapS = THREE.RepeatWrapping;
        texture.wrapT = THREE.RepeatWrapping;
        texture.magFilter = THREE.NearestFilter;
        const repeats = planeSize / 2;
        texture.repeat.set(repeats, repeats);


        const planeGeo = new THREE.PlaneGeometry(planeSize, planeSize);
        const planeMat = new THREE.MeshPhongMaterial({
            map: texture,
            side: THREE.DoubleSide,
        });
        const plane = new THREE.Mesh(planeGeo, planeMat);
        plane.receiveShadow = true;
        plane.rotation.x = Math.PI * -.5;


        // plane = new THREE.Mesh(new THREE.PlaneGeometry(500, 500), groundMaterial);
        // plane.rotation.x = -Math.PI / 2;
        // plane.receiveShadow = true;
        scene.add(plane);
        // LIGHTS
        scene.add(new THREE.AmbientLight(0x666666));
        var light;
        light = new THREE.DirectionalLight(0xdfebff, 1.75);
        light.position.set(30, 40, 5);
        light.position.multiplyScalar(1.3);
        light.castShadow = true;
        // light.shadowCameraVisible = true;
        light.shadow.mapSize.width = 512;
        light.shadow.mapSize.height = 512;
        var d = 20;
        light.shadow.camera.left = -d;
        light.shadow.camera.right = d;
        light.shadow.camera.top = d;
        light.shadow.camera.bottom = -d;
        light.shadow.camera.far = 100;
        // light.shadowDarkness = 0.2;
        scene.add(light);

        var helper = new THREE.CameraHelper(light.shadow.camera);
        scene.add(helper);


        var light_2;
        light_2 = new THREE.DirectionalLight(0xdfebff, 1.75);
        light_2.position.set(-30, -40, -5);
        light_2.position.multiplyScalar(1.3);
        light_2.castShadow = true;
        // light.shadowCameraVisible = true;
        light_2.shadow.mapSize.width = 512;
        light_2.shadow.mapSize.height = 512;
        var d = 20;
        light_2.shadow.camera.left = -d;
        light_2.shadow.camera.right = d;
        light_2.shadow.camera.top = d;
        light_2.shadow.camera.bottom = -d;
        light_2.shadow.camera.far = 100;
        // light.shadowDarkness = 0.2;
        scene.add(light_2);

        var helper_2 = new THREE.CameraHelper(light_2.shadow.camera);
        // scene.add(helper_2);

        spotLight = new THREE.SpotLight(0xffffff);
        spotLight.name = 'Spot Light';
        spotLight.angle = Math.PI / 5;
        spotLight.penumbra = 0.3;
        spotLight.position.set(10, 60, -40);
        spotLight.castShadow = true;
        spotLight.shadow.camera.near = 80;
        spotLight.shadow.camera.far = 150;
        spotLight.shadow.camera.left = -d;
        spotLight.shadow.camera.right = d;
        spotLight.shadow.camera.top = d;
        spotLight.shadow.camera.bottom = -d;
        spotLight.shadow.mapSize.width = 512;
        spotLight.shadow.mapSize.height = 512;
        // scene.add(spotLight);

        var spotLight_helper = new THREE.CameraHelper(spotLight.shadow.camera);
        // scene.add(spotLight_helper);

        const flakesTexture = loader.load('./src/flakes.png')

        var boxgeometry = new THREE.SphereGeometry( 15, 32, 16 );
        var front_material = new THREE.MeshStandardMaterial({
            side: THREE.FrontSide,
            // clearcoat: 1.0,
            // clearcoatRoughness: 0,
            metalness: 0.65,
            roughness: 0.3,
            color: 'black',
            normalMap: flakesTexture,
            normalScale: new THREE.Vector2(0.3, 0.3),
            // normalMap.wrapS: THREE.RepeatWrapping,
            // normalMap.wrapT: THREE.RepeatWrapping,
            // normalMap.repeat: [30, 30],
            // normalMap-anisotropy': 16,
            // transmission: 0.6,
            transparent: true,
            opacity: 0.4
        });
        var back_material = new THREE.MeshStandardMaterial({
            side: THREE.BackSide,
            color: 0x0aeedf,
            // clearcoat: 1.0,
            // clearcoatRoughness: 0,
            metalness: 0.65,
            roughness: 0.3,
            color: 'red',
            normalMap: flakesTexture,
            normalScale: new THREE.Vector2(0.3, 0.3),
            // normalMap.wrapS: THREE.RepeatWrapping,
            // normalMap.wrapT: THREE.RepeatWrapping,
            // normalMap.repeat: [30, 30],
            // normalMap-anisotropy': 16,
            // transmission: 0.6,
            transparent: true,
            opacity: 0.8
        });
        front_material.normalMap.wrapS = front_material.normalMap.wrapT = THREE.RepeatWrapping
        front_material.normalMap.repeat = new THREE.Vector2(30, 30)

        back_material.normalMap.wrapS = back_material.normalMap.wrapT = THREE.RepeatWrapping
        back_material.normalMap.repeat = new THREE.Vector2(30, 30)
        var group = new THREE.Group();

        // var glass_material = new THREE.MeshBasicMaterial({
        // color: 'cyan',
        // transparent: true,
        // // opacity: 0.4
        // });

        var f_cube = new THREE.Mesh(boxgeometry, front_material);
        f_cube.renderOrder = 2;
        var b_cube = new THREE.Mesh(boxgeometry, back_material);
        b_cube.renderOrder = 1;
        group.add(f_cube)
        group.add(b_cube)

        group.castShadow = true;
        group.position.x = 10;
        group.position.y = 20;
        group.position.z = 0;
        scene.add(group);
        // RENDERER
        webglRenderer = new THREE.WebGLRenderer();
        webglRenderer.setSize(window.innerWidth, window.innerHeight);
        webglRenderer.domElement.style.position = "relative";
        webglRenderer.shadowMap.enabled = true;
        webglRenderer.shadowMapSoft = true;
        container.appendChild(webglRenderer.domElement);
        window.addEventListener('resize', onWindowResize, false);

        controls = new THREE.OrbitControls(camera, webglRenderer.domElement);
    }

    function onWindowResize() {
        windowHalfX = window.innerWidth / 2;
        windowHalfY = window.innerHeight / 2;
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        webglRenderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
        // var timer = Date.now() * 0.0002;
        // camera.position.x = Math.cos(timer) * 10000;
        // camera.position.z = Math.sin(timer) * 10000;
        requestAnimationFrame(animate);
        render();
    }

    function render() {
        camera.lookAt(scene.position);
        webglRenderer.render(scene, camera);
    }
</script>
</body>
</html>